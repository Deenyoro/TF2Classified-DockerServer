# =============================================================================
# TF2 Classified Docker Server — Configuration
# =============================================================================
# Copy to .env and edit. All values have sane defaults.
# =============================================================================

# ─── Server Identity ────────────────────────────────────────────────────────
SERVER_NAME=My TF2 Classified Server
SERVER_PASSWORD=
RCON_PASSWORD=changeme

# ─── Gameplay ───────────────────────────────────────────────────────────────
START_MAP=ctf_2fort
MAX_PLAYERS=24
SERVER_PORT=27015
TICKRATE=66

# ─── IP Privacy / Networking ────────────────────────────────────────────────
#
# You have three hosting options:
#
# OPTION A: Steam Datagram Relay (default, zero setup)
#   STEAM_NETWORKING=true
#   Your IP is hidden behind Valve's relay. Built-in DDoS protection.
#   Downside: players CANNOT favorite your server (relay address is ephemeral).
#
# OPTION B: Direct / port-forward (full control, IP exposed)
#   STEAM_NETWORKING=false
#   Forward port 27015/UDP on your router.
#   Players connect by your public IP. Your IP is exposed.
#
STEAM_NETWORKING=true

# ─── server.cfg Handling ──────────────────────────────────────────────────
#
# auto   = (default) entrypoint writes server.cfg from these .env values on
#          every boot. Your custom overrides go in data/cfg/server_custom.cfg
#          which gets exec'd at the end.
#
# custom = entrypoint does NOT touch server.cfg. You manage it yourself.
#          Put your own server.cfg in data/cfg/server.cfg and it gets
#          symlinked into the game directory. Full control, full responsibility.
#
SERVER_CFG_MODE=auto

# ─── Auto-Update ────────────────────────────────────────────────────────────
# Check for TF2 and TF2C updates every time the container starts
UPDATE_ON_START=true
# Set to false on additional servers that share game volumes
# (only the primary server should download/update game files)
UPDATE_GAME_FILES=true
# Set to 1 to add "validate" to SteamCMD (slower but repairs corrupt installs)
VALIDATE_INSTALL=0
#
# Background auto-update: polls Steam for new builds while the server is
# running. When an update is detected, behavior depends on AUTO_UPDATE_MODE.
AUTO_UPDATE=true
# How often to check, in seconds (default: 300 = 5 minutes)
AUTO_UPDATE_INTERVAL=300
#
# Auto-update mode:
#   immediate  — Stop server right away when update detected (default)
#   graceful   — Warn players in chat, wait UPDATE_GRACE_PERIOD, then restart
#   announce   — Warn players but wait for manual restart (no auto-restart)
AUTO_UPDATE_MODE=immediate
#
# Grace period for "graceful" mode (seconds). Players see countdown warnings.
# To extend during countdown: docker compose exec tf2classified touch /tmp/extend_update_grace
UPDATE_GRACE_PERIOD=60

# ─── Server Browser Tags ───────────────────────────────────────────────────
# Comma-separated. Special TF2C tags (verified servers only):
#   type_customrules     — drastic ruleset changes (civilian, bhop, etc.)
#   type_customweapons   — custom weapons / rebalance / throwback packs
SV_TAGS=

# ─── SourceMod Admin ───────────────────────────────────────────────────────
# Steam IDs in STEAM_X:Y:Z format. Find yours at https://steamid.io/
# Comma-separated for multiple admins:
#   SM_ADMIN_STEAMID=STEAM_0:1:12345678,STEAM_0:0:87654321
SM_ADMIN_STEAMID=

# ─── Extra Launch Arguments ────────────────────────────────────────────────
# Appended to the srcds_linux64 command line.
# Example: +sv_logecho 1 +sv_logsdir logs
EXTRA_ARGS=

# ─── Optional Addons ──────────────────────────────────────────────────────
# Enable/disable optional SourceMod plugins. All disabled by default.
# Set to "true" to install and activate on next container start.
# Set to "false" (or leave commented) to disable.
#
# tf2attributes — Library that lets plugins read/write item attributes.
#   Required by some other mods. No gameplay effect on its own.
#   https://github.com/FlaminSarge/tf2attributes
ADDON_TF2ATTRIBUTES=false
#
# MapChooser Extended — Enhanced end-of-map voting with nominations and
#   Rock The Vote (RTV). Replaces the stock SourceMod mapchooser.
#   Players can nominate maps and vote to change the current map.
#   https://github.com/Totenfluch/sourcemod-mapchooser-extended
ADDON_MAPCHOOSER_EXTENDED=false
#
# NativeVotes — Replaces SourceMod's generic vote menu with the game's
#   native vote UI (TF2-style vote popups). Includes vote kick, vote map,
#   fun votes (gravity, alltalk, etc). If MapChooser Extended is also
#   enabled, NativeVotes provides the vote UI while MCE handles map voting.
#   https://github.com/Heapons/sourcemod-nativevotes-updated
ADDON_NATIVEVOTES=false
#
# Advertisements — Display rotating server messages in chat, center text,
#   or hint text at configurable intervals. Edit the ad content at:
#   data/addons/sourcemod/configs/advertisements.txt
#   https://github.com/ErikMinekus/sm-advertisements
ADDON_ADVERTISEMENTS=false
#
# Roll The Dice (RTD) — Players type !rtd to get a random temporary effect
#   (good or bad). 80+ effects including speed boost, crits, low gravity,
#   invisibility, and more. Great for fun/casual servers.
#   Uses a custom TF2C-compatible build.
#   https://github.com/Phil25/RTD
ADDON_RTD=false
#
# Versus Saxton Hale (VSH) — Boss vs. Mercenaries arena mode. One player
#   becomes Saxton Hale (massive HP, super jump, rage) while everyone
#   else tries to take them down. Requires vsh_ prefixed maps.
#   Automatically installs TF2Items extension (required dependency).
#   https://github.com/Chdata/Versus-Saxton-Hale
ADDON_VSH=false
#
# War3Source (Warcraft 3: Source) — RPG mod with races, leveling, skills,
#   ultimates, gold, and a shop system. Players pick a race and earn XP
#   through kills. 20+ races with unique abilities. Compiles from source
#   on first boot (takes a moment). Saves player progress to database.
#   https://github.com/War3Evo/War3Source-EVO
ADDON_WAR3SOURCE=false
#
# Round-Time — Control round time, setup time, and capture time bonuses.
#   Admin commands: sm_addtime, sm_settime. ConVars: sm_time_setup, sm_time_max, etc.
#   https://github.com/KatsuteTF/Round-Time
ADDON_ROUNDTIME=false
#
# Map Config (YAMCP) — Execute different cfg files per map, prefix, or gametype.
#   Creates cfg/mapconfig/ directory structure. Edit all.cfg, gametype/cp.cfg,
#   maps/pl_upward.cfg, etc. to configure per-map settings.
#   https://github.com/nosoop/SM-YetAnotherMapConfigPlugin
ADDON_MAPCONFIG=false

# ─── Addon Download URLs ─────────────────────────────────────────────────
# Override to pin specific versions. Defaults are known-good builds.
# You normally don't need to change these.
#
# TF2ATTR_URL=https://github.com/FlaminSarge/tf2attributes/releases/download/v1.7.5
# MCE_URL=https://github.com/Totenfluch/sourcemod-mapchooser-extended/archive/refs/heads/master.tar.gz
# NATIVEVOTES_URL=https://github.com/Heapons/sourcemod-nativevotes-updated/releases/download/workflow-build37/nativevotes_sm_1.13.zip
# ADVERTISEMENTS_URL=https://github.com/ErikMinekus/sm-advertisements/releases/download/2.1.2/advertisements.zip
# RTD_URL=https://github.com/Phil25/RTD/releases/download/2.5.5/rtd-2.5.5.zip
# VSH_URL=https://github.com/Chdata/Versus-Saxton-Hale/archive/refs/heads/master.tar.gz
# TF2ITEMS_URL=https://github.com/nosoop/SMExt-TF2Items/releases/download/r13-main/package.tar.gz
# WAR3SOURCE_URL=https://github.com/War3Evo/War3Source-EVO/archive/refs/heads/master.tar.gz
# ROUNDTIME_URL=https://github.com/KatsuteTF/Round-Time/releases/download/1.0/Time.smx

# ─── Mod Download URLs ─────────────────────────────────────────────────────
# These default to known-good 64-bit builds. Override to pin versions.
# Set any to "skip" to disable installing that component.
#
# MetaMod:Source 2.0 (build 1384 — minimum required for TF2C is 1380)
MMS_URL=https://mms.alliedmods.net/mmsdrop/2.0/mmsource-2.0.0-git1384-linux.tar.gz
#
# SourceMod 1.13 (build 7293 — includes TF2 Classified gamedata)
SM_URL=https://sm.alliedmods.net/smdrop/1.13/sourcemod-1.13.0-git7293-linux.tar.gz
#
# SMJansson (JSON extension) is bundled in the image — no URL needed.
#
# Set to "false" to skip all mod installation
INSTALL_MODS=true

# ─── FastDL — Custom Map Downloads ─────────────────────────────────────────
# Source engine clients download custom content from this URL over HTTP.
# Much faster than the in-game transfer. The web server must mirror the
# game directory layout:
#   <FASTDL_URL>/maps/yourmap.bsp.bz2  (compressed — client tries first)
#   <FASTDL_URL>/maps/yourmap.bsp      (fallback)
#
# Hosting options:
#   - Cloudflare R2 (free 10GB, global CDN, good for production)
#   - Self-hosted nginx (included — run: docker compose --profile fastdl up -d)
#   - Any HTTP server (S3, Backblaze B2, your own VPS, etc.)
#
# For self-hosted: drop maps in data/maps/, run "make compress-maps",
# then set this to http://your-ip:8080/tf2classified
#
# Leave empty to disable.
FASTDL_URL=
FASTDL_PORT=8080

# ─── Cloudflare R2 Upload (Optional) ─────────────────────────────────────
# Only needed if you use:  make upload-maps
# 1. Create an R2 bucket in your Cloudflare dashboard
# 2. Create an API token with R2 read/write access
# 3. Put credentials in .r2/credentials (AWS CLI format)
# 4. Fill in these values
#
# R2_ENDPOINT=https://<account-id>.r2.cloudflarestorage.com
# R2_BUCKET=my-fastdl-bucket
# R2_PUBLIC_URL=https://<public-bucket-url>/tf2classified/
R2_ENDPOINT=
R2_BUCKET=
R2_PUBLIC_URL=

# ─── Docker Logging ───────────────────────────────────────────────────────
# Controls Docker's container log output (stdout/stderr from entrypoint).
# These are separate from srcds game logs which go to data/logs/.
#
# Max size per log file (e.g., "10m", "50m", "100m")
LOG_MAX_SIZE=10m
# Number of rotated log files to keep
LOG_MAX_FILE=3

# ─── Debugging ────────────────────────────────────────────────────────────
# Keep tmux session alive after srcds crashes (for troubleshooting).
# Attach with: docker compose exec tf2classified tmux attach -t srcds
# Set to "true" to enable, "false" to disable (default).
TMUX_REMAIN_ON_EXIT=false

# ─── WireGuard Relay ──────────────────────────────────────────────────────
# Only used with: make relay
# Routes ALL server traffic through a WireGuard tunnel to a remote firewall.
# Your home IP is hidden; players connect to the relay's public IP.
#
# Generate keys:  wg genkey | tee privatekey | wg pubkey > publickey
# See wireguard/remote-firewall.conf.example for the remote side config.
#
# WG_PRIVATE_KEY=<your-home-server-private-key>
# WG_ADDRESS=10.0.0.2/24
# WG_DNS=1.1.1.1
# WG_PEER_PUBLIC_KEY=<remote-firewall-public-key>
# WG_ENDPOINT=<remote-firewall-ip-or-hostname>:51820
# WG_PERSISTENT_KEEPALIVE=25
# WG_RERESOLVE_INTERVAL=300

# ─── Container Settings ────────────────────────────────────────────────────
PUID=1000
PGID=1000
TZ=UTC
