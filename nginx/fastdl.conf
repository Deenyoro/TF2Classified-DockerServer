# Nginx FastDL Configuration for TF2 Classified
# Serves custom maps and content to players via HTTP

server {
    listen 80;
    server_name _;

    root /usr/share/nginx/html;

    # Health check endpoint
    location /health {
        return 200 'OK';
        add_header Content-Type text/plain;
    }

    # Game content files
    location ~* \.(bsp|bz2|vtf|vmt|mdl|vtx|vvd|phy|wav|mp3|txt|res|nav)$ {
        add_header Access-Control-Allow-Origin *;
        add_header Access-Control-Allow-Methods 'GET, HEAD, OPTIONS';
        expires 7d;
        add_header Cache-Control "public, immutable";
    }

    # Block config and log files
    location ~* \.(cfg|ini|log)$ {
        deny all;
        return 403;
    }

    # Block hidden files
    location ~ /\. {
        deny all;
        return 404;
    }

    # Disable directory listing
    autoindex off;

    # Performance
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;

    # Maps can be large
    client_max_body_size 256M;

    access_log /var/log/nginx/fastdl_access.log;
    error_log /var/log/nginx/fastdl_error.log;
}
