# TF2 Classified Dedicated Server
#
# Usage:
#   docker compose up -d                                       # default (Steam relay, IP hidden)
#   docker compose --profile playit up -d                      # with playit.gg tunnel
#   docker compose --profile fastdl up -d                      # with self-hosted FastDL
#   docker compose --profile playit --profile fastdl up -d     # both
#   docker compose --profile server2 up -d                     # run second server
#
# Steam Datagram Relay hides your IP by default. playit.gg is optional
# if you want a stable address players can favorite.
#
# Multiple servers share the tf2-data volume (TF2 base, ~15GB) so it only
# downloads once. Each server gets its own TF2 Classified volume and config.

services:
  tf2classified:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        PUID: ${PUID:-1000}
        PGID: ${PGID:-1000}
    container_name: tf2classified
    restart: unless-stopped

    # Host networking avoids Docker NAT overhead and is required for
    # Steam networking relay to function correctly.
    network_mode: host

    env_file:
      - .env

    volumes:
      # Game files persist in named volumes (~20GB, survives rebuilds)
      - tf2-data:/data/tf
      - classified-data:/data/classified

      # Your custom content (bind-mounted, read-only)
      - ./data/cfg:/data/cfg:ro
      - ./data/addons:/data/addons:ro
      - ./data/maps:/data/maps:ro

      # Writable outputs
      - ./data/logs:/data/logs
      - ./data/demos:/data/demos

    # Give srcds time to disconnect players and save state
    stop_grace_period: 30s

    stdin_open: true
    tty: true

    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    profiles:
      - server1

  # --------------------------------------------------------------------------
  # FastDL web server (optional)
  #
  # Serves custom maps/content over HTTP so players don't suffer the slow
  # in-game transfer.
  #
  # Setup:
  #   1. Drop .bsp files in data/maps/
  #   2. Run: make compress-maps
  #   3. Set FASTDL_URL in .env (e.g. http://your-ip:8080/tf2classified)
  #   4. docker compose --profile fastdl up -d
  #
  # Or use an external CDN (Cloudflare R2, S3, etc.) and just set FASTDL_URL.
  # --------------------------------------------------------------------------
  fastdl:
    image: nginx:alpine
    container_name: tf2c-fastdl
    restart: unless-stopped
    ports:
      - "${FASTDL_PORT:-8080}:80"
    volumes:
      - ./data/fastdl:/usr/share/nginx/html:ro
      - ./nginx/fastdl.conf:/etc/nginx/conf.d/default.conf:ro
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    cap_add:
      - NET_BIND_SERVICE
    read_only: true
    tmpfs:
      - /var/cache/nginx
      - /var/run
      - /var/log/nginx
    logging:
      driver: json-file
      options:
        max-size: "5m"
        max-file: "2"
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost/health"]
      interval: 30s
      timeout: 5s
      retries: 3
    profiles:
      - fastdl

  # --------------------------------------------------------------------------
  # playit.gg tunnel (optional)
  #
  # Gives a stable public address (e.g. something.playit.gg:12345) that
  # players can favorite, while still hiding your origin IP.
  #
  # Setup:
  #   1. Create account + UDP tunnel at https://playit.gg
  #   2. Set PLAYIT_SECRET_KEY in .env
  #   3. Set STEAM_NETWORKING=false in .env
  #   4. docker compose --profile playit up -d
  # --------------------------------------------------------------------------
  playit:
    image: playitcloud/playit:latest
    container_name: tf2c-playit
    restart: unless-stopped
    network_mode: host
    environment:
      - SECRET_KEY=${PLAYIT_SECRET_KEY:-}
    profiles:
      - playit

  # --------------------------------------------------------------------------
  # Additional server instance (optional)
  #
  # Shares game volumes with the primary server so you don't re-download
  # ~20GB. Only needs its own configs, plugins, and port.
  #
  # Setup:
  #   1. make add-server N=2        (creates dirs + .env.server2)
  #   2. Edit .env.server2          (change name, port, RCON, etc.)
  #   3. docker compose --profile server2 up -d
  #
  # To add more: duplicate this block, change "2" to "3", etc.
  # The primary server must be running first (it owns the TF2 base volume).
  # --------------------------------------------------------------------------
  tf2classified-2:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        PUID: ${PUID:-1000}
        PGID: ${PGID:-1000}
    container_name: tf2classified-2
    restart: unless-stopped
    network_mode: host
    env_file:
      - .env.server2
    volumes:
      - tf2-data:/data/tf
      - classified-data:/data/classified
      - ./servers/2/cfg:/data/cfg:ro
      - ./servers/2/addons:/data/addons:ro
      - ./servers/2/maps:/data/maps:ro
      - ./servers/2/logs:/data/logs
      - ./servers/2/demos:/data/demos
    stop_grace_period: 30s
    stdin_open: true
    tty: true
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    profiles:
      - server2

  tf2classified-3:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        PUID: ${PUID:-1000}
        PGID: ${PGID:-1000}
    container_name: tf2classified-3
    restart: unless-stopped
    network_mode: host
    env_file:
      - .env.server3
    volumes:
      - tf2-data:/data/tf
      - classified-data:/data/classified
      - ./servers/3/cfg:/data/cfg:ro
      - ./servers/3/addons:/data/addons:ro
      - ./servers/3/maps:/data/maps:ro
      - ./servers/3/logs:/data/logs
      - ./servers/3/demos:/data/demos
    stop_grace_period: 30s
    stdin_open: true
    tty: true
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    profiles:
      - server3

  tf2classified-4:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        PUID: ${PUID:-1000}
        PGID: ${PGID:-1000}
    container_name: tf2classified-4
    restart: unless-stopped
    network_mode: host
    env_file:
      - .env.server4
    volumes:
      - tf2-data:/data/tf
      - classified-data:/data/classified
      - ./servers/4/cfg:/data/cfg:ro
      - ./servers/4/addons:/data/addons:ro
      - ./servers/4/maps:/data/maps:ro
      - ./servers/4/logs:/data/logs
      - ./servers/4/demos:/data/demos
    stop_grace_period: 30s
    stdin_open: true
    tty: true
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    profiles:
      - server4

  tf2classified-5:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        PUID: ${PUID:-1000}
        PGID: ${PGID:-1000}
    container_name: tf2classified-5
    restart: unless-stopped
    network_mode: host
    env_file:
      - .env.server5
    volumes:
      - tf2-data:/data/tf
      - classified-data:/data/classified
      - ./servers/5/cfg:/data/cfg:ro
      - ./servers/5/addons:/data/addons:ro
      - ./servers/5/maps:/data/maps:ro
      - ./servers/5/logs:/data/logs
      - ./servers/5/demos:/data/demos
    stop_grace_period: 30s
    stdin_open: true
    tty: true
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    profiles:
      - server5

  tf2classified-6:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        PUID: ${PUID:-1000}
        PGID: ${PGID:-1000}
    container_name: tf2classified-6
    restart: unless-stopped
    network_mode: host
    env_file:
      - .env.server6
    volumes:
      - tf2-data:/data/tf
      - classified-data:/data/classified
      - ./servers/6/cfg:/data/cfg:ro
      - ./servers/6/addons:/data/addons:ro
      - ./servers/6/maps:/data/maps:ro
      - ./servers/6/logs:/data/logs
      - ./servers/6/demos:/data/demos
    stop_grace_period: 30s
    stdin_open: true
    tty: true
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    profiles:
      - server6

  tf2classified-7:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        PUID: ${PUID:-1000}
        PGID: ${PGID:-1000}
    container_name: tf2classified-7
    restart: unless-stopped
    network_mode: host
    env_file:
      - .env.server7
    volumes:
      - tf2-data:/data/tf
      - classified-data:/data/classified
      - ./servers/7/cfg:/data/cfg:ro
      - ./servers/7/addons:/data/addons:ro
      - ./servers/7/maps:/data/maps:ro
      - ./servers/7/logs:/data/logs
      - ./servers/7/demos:/data/demos
    stop_grace_period: 30s
    stdin_open: true
    tty: true
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    profiles:
      - server7

  tf2classified-8:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        PUID: ${PUID:-1000}
        PGID: ${PGID:-1000}
    container_name: tf2classified-8
    restart: unless-stopped
    network_mode: host
    env_file:
      - .env.server8
    volumes:
      - tf2-data:/data/tf
      - classified-data:/data/classified
      - ./servers/8/cfg:/data/cfg:ro
      - ./servers/8/addons:/data/addons:ro
      - ./servers/8/maps:/data/maps:ro
      - ./servers/8/logs:/data/logs
      - ./servers/8/demos:/data/demos
    stop_grace_period: 30s
    stdin_open: true
    tty: true
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    profiles:
      - server8

  tf2classified-9:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        PUID: ${PUID:-1000}
        PGID: ${PGID:-1000}
    container_name: tf2classified-9
    restart: unless-stopped
    network_mode: host
    env_file:
      - .env.server9
    volumes:
      - tf2-data:/data/tf
      - classified-data:/data/classified
      - ./servers/9/cfg:/data/cfg:ro
      - ./servers/9/addons:/data/addons:ro
      - ./servers/9/maps:/data/maps:ro
      - ./servers/9/logs:/data/logs
      - ./servers/9/demos:/data/demos
    stop_grace_period: 30s
    stdin_open: true
    tty: true
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    profiles:
      - server9

  tf2classified-10:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        PUID: ${PUID:-1000}
        PGID: ${PGID:-1000}
    container_name: tf2classified-10
    restart: unless-stopped
    network_mode: host
    env_file:
      - .env.server10
    volumes:
      - tf2-data:/data/tf
      - classified-data:/data/classified
      - ./servers/10/cfg:/data/cfg:ro
      - ./servers/10/addons:/data/addons:ro
      - ./servers/10/maps:/data/maps:ro
      - ./servers/10/logs:/data/logs
      - ./servers/10/demos:/data/demos
    stop_grace_period: 30s
    stdin_open: true
    tty: true
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    profiles:
      - server10

  tf2classified-11:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        PUID: ${PUID:-1000}
        PGID: ${PGID:-1000}
    container_name: tf2classified-11
    restart: unless-stopped
    network_mode: host
    env_file:
      - .env.server11
    volumes:
      - tf2-data:/data/tf
      - classified-data:/data/classified
      - ./servers/11/cfg:/data/cfg:ro
      - ./servers/11/addons:/data/addons:ro
      - ./servers/11/maps:/data/maps:ro
      - ./servers/11/logs:/data/logs
      - ./servers/11/demos:/data/demos
    stop_grace_period: 30s
    stdin_open: true
    tty: true
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    profiles:
      - server11

  tf2classified-12:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        PUID: ${PUID:-1000}
        PGID: ${PGID:-1000}
    container_name: tf2classified-12
    restart: unless-stopped
    network_mode: host
    env_file:
      - .env.server12
    volumes:
      - tf2-data:/data/tf
      - classified-data:/data/classified
      - ./servers/12/cfg:/data/cfg:ro
      - ./servers/12/addons:/data/addons:ro
      - ./servers/12/maps:/data/maps:ro
      - ./servers/12/logs:/data/logs
      - ./servers/12/demos:/data/demos
    stop_grace_period: 30s
    stdin_open: true
    tty: true
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    profiles:
      - server12

  tf2classified-13:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        PUID: ${PUID:-1000}
        PGID: ${PGID:-1000}
    container_name: tf2classified-13
    restart: unless-stopped
    network_mode: host
    env_file:
      - .env.server13
    volumes:
      - tf2-data:/data/tf
      - classified-data:/data/classified
      - ./servers/13/cfg:/data/cfg:ro
      - ./servers/13/addons:/data/addons:ro
      - ./servers/13/maps:/data/maps:ro
      - ./servers/13/logs:/data/logs
      - ./servers/13/demos:/data/demos
    stop_grace_period: 30s
    stdin_open: true
    tty: true
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    profiles:
      - server13

  tf2classified-14:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        PUID: ${PUID:-1000}
        PGID: ${PGID:-1000}
    container_name: tf2classified-14
    restart: unless-stopped
    network_mode: host
    env_file:
      - .env.server14
    volumes:
      - tf2-data:/data/tf
      - classified-data:/data/classified
      - ./servers/14/cfg:/data/cfg:ro
      - ./servers/14/addons:/data/addons:ro
      - ./servers/14/maps:/data/maps:ro
      - ./servers/14/logs:/data/logs
      - ./servers/14/demos:/data/demos
    stop_grace_period: 30s
    stdin_open: true
    tty: true
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    profiles:
      - server14

  tf2classified-15:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        PUID: ${PUID:-1000}
        PGID: ${PGID:-1000}
    container_name: tf2classified-15
    restart: unless-stopped
    network_mode: host
    env_file:
      - .env.server15
    volumes:
      - tf2-data:/data/tf
      - classified-data:/data/classified
      - ./servers/15/cfg:/data/cfg:ro
      - ./servers/15/addons:/data/addons:ro
      - ./servers/15/maps:/data/maps:ro
      - ./servers/15/logs:/data/logs
      - ./servers/15/demos:/data/demos
    stop_grace_period: 30s
    stdin_open: true
    tty: true
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    profiles:
      - server15

  tf2classified-16:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        PUID: ${PUID:-1000}
        PGID: ${PGID:-1000}
    container_name: tf2classified-16
    restart: unless-stopped
    network_mode: host
    env_file:
      - .env.server16
    volumes:
      - tf2-data:/data/tf
      - classified-data:/data/classified
      - ./servers/16/cfg:/data/cfg:ro
      - ./servers/16/addons:/data/addons:ro
      - ./servers/16/maps:/data/maps:ro
      - ./servers/16/logs:/data/logs
      - ./servers/16/demos:/data/demos
    stop_grace_period: 30s
    stdin_open: true
    tty: true
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    profiles:
      - server16

  tf2classified-17:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        PUID: ${PUID:-1000}
        PGID: ${PGID:-1000}
    container_name: tf2classified-17
    restart: unless-stopped
    network_mode: host
    env_file:
      - .env.server17
    volumes:
      - tf2-data:/data/tf
      - classified-data:/data/classified
      - ./servers/17/cfg:/data/cfg:ro
      - ./servers/17/addons:/data/addons:ro
      - ./servers/17/maps:/data/maps:ro
      - ./servers/17/logs:/data/logs
      - ./servers/17/demos:/data/demos
    stop_grace_period: 30s
    stdin_open: true
    tty: true
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    profiles:
      - server17

  tf2classified-18:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        PUID: ${PUID:-1000}
        PGID: ${PGID:-1000}
    container_name: tf2classified-18
    restart: unless-stopped
    network_mode: host
    env_file:
      - .env.server18
    volumes:
      - tf2-data:/data/tf
      - classified-data:/data/classified
      - ./servers/18/cfg:/data/cfg:ro
      - ./servers/18/addons:/data/addons:ro
      - ./servers/18/maps:/data/maps:ro
      - ./servers/18/logs:/data/logs
      - ./servers/18/demos:/data/demos
    stop_grace_period: 30s
    stdin_open: true
    tty: true
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    profiles:
      - server18

  tf2classified-19:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        PUID: ${PUID:-1000}
        PGID: ${PGID:-1000}
    container_name: tf2classified-19
    restart: unless-stopped
    network_mode: host
    env_file:
      - .env.server19
    volumes:
      - tf2-data:/data/tf
      - classified-data:/data/classified
      - ./servers/19/cfg:/data/cfg:ro
      - ./servers/19/addons:/data/addons:ro
      - ./servers/19/maps:/data/maps:ro
      - ./servers/19/logs:/data/logs
      - ./servers/19/demos:/data/demos
    stop_grace_period: 30s
    stdin_open: true
    tty: true
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    profiles:
      - server19

  tf2classified-20:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        PUID: ${PUID:-1000}
        PGID: ${PGID:-1000}
    container_name: tf2classified-20
    restart: unless-stopped
    network_mode: host
    env_file:
      - .env.server20
    volumes:
      - tf2-data:/data/tf
      - classified-data:/data/classified
      - ./servers/20/cfg:/data/cfg:ro
      - ./servers/20/addons:/data/addons:ro
      - ./servers/20/maps:/data/maps:ro
      - ./servers/20/logs:/data/logs
      - ./servers/20/demos:/data/demos
    stop_grace_period: 30s
    stdin_open: true
    tty: true
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    profiles:
      - server20

  tf2classified-21:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        PUID: ${PUID:-1000}
        PGID: ${PGID:-1000}
    container_name: tf2classified-21
    restart: unless-stopped
    network_mode: host
    env_file:
      - .env.server21
    volumes:
      - tf2-data:/data/tf
      - classified-data:/data/classified
      - ./servers/21/cfg:/data/cfg:ro
      - ./servers/21/addons:/data/addons:ro
      - ./servers/21/maps:/data/maps:ro
      - ./servers/21/logs:/data/logs
      - ./servers/21/demos:/data/demos
    stop_grace_period: 30s
    stdin_open: true
    tty: true
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    profiles:
      - server21

  tf2classified-22:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        PUID: ${PUID:-1000}
        PGID: ${PGID:-1000}
    container_name: tf2classified-22
    restart: unless-stopped
    network_mode: host
    env_file:
      - .env.server22
    volumes:
      - tf2-data:/data/tf
      - classified-data:/data/classified
      - ./servers/22/cfg:/data/cfg:ro
      - ./servers/22/addons:/data/addons:ro
      - ./servers/22/maps:/data/maps:ro
      - ./servers/22/logs:/data/logs
      - ./servers/22/demos:/data/demos
    stop_grace_period: 30s
    stdin_open: true
    tty: true
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    profiles:
      - server22

  tf2classified-23:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        PUID: ${PUID:-1000}
        PGID: ${PGID:-1000}
    container_name: tf2classified-23
    restart: unless-stopped
    network_mode: host
    env_file:
      - .env.server23
    volumes:
      - tf2-data:/data/tf
      - classified-data:/data/classified
      - ./servers/23/cfg:/data/cfg:ro
      - ./servers/23/addons:/data/addons:ro
      - ./servers/23/maps:/data/maps:ro
      - ./servers/23/logs:/data/logs
      - ./servers/23/demos:/data/demos
    stop_grace_period: 30s
    stdin_open: true
    tty: true
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    profiles:
      - server23

  tf2classified-24:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        PUID: ${PUID:-1000}
        PGID: ${PGID:-1000}
    container_name: tf2classified-24
    restart: unless-stopped
    network_mode: host
    env_file:
      - .env.server24
    volumes:
      - tf2-data:/data/tf
      - classified-data:/data/classified
      - ./servers/24/cfg:/data/cfg:ro
      - ./servers/24/addons:/data/addons:ro
      - ./servers/24/maps:/data/maps:ro
      - ./servers/24/logs:/data/logs
      - ./servers/24/demos:/data/demos
    stop_grace_period: 30s
    stdin_open: true
    tty: true
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    profiles:
      - server24

  tf2classified-25:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        PUID: ${PUID:-1000}
        PGID: ${PGID:-1000}
    container_name: tf2classified-25
    restart: unless-stopped
    network_mode: host
    env_file:
      - .env.server25
    volumes:
      - tf2-data:/data/tf
      - classified-data:/data/classified
      - ./servers/25/cfg:/data/cfg:ro
      - ./servers/25/addons:/data/addons:ro
      - ./servers/25/maps:/data/maps:ro
      - ./servers/25/logs:/data/logs
      - ./servers/25/demos:/data/demos
    stop_grace_period: 30s
    stdin_open: true
    tty: true
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    profiles:
      - server25

  tf2classified-26:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        PUID: ${PUID:-1000}
        PGID: ${PGID:-1000}
    container_name: tf2classified-26
    restart: unless-stopped
    network_mode: host
    env_file:
      - .env.server26
    volumes:
      - tf2-data:/data/tf
      - classified-data:/data/classified
      - ./servers/26/cfg:/data/cfg:ro
      - ./servers/26/addons:/data/addons:ro
      - ./servers/26/maps:/data/maps:ro
      - ./servers/26/logs:/data/logs
      - ./servers/26/demos:/data/demos
    stop_grace_period: 30s
    stdin_open: true
    tty: true
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    profiles:
      - server26

  tf2classified-27:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        PUID: ${PUID:-1000}
        PGID: ${PGID:-1000}
    container_name: tf2classified-27
    restart: unless-stopped
    network_mode: host
    env_file:
      - .env.server27
    volumes:
      - tf2-data:/data/tf
      - classified-data:/data/classified
      - ./servers/27/cfg:/data/cfg:ro
      - ./servers/27/addons:/data/addons:ro
      - ./servers/27/maps:/data/maps:ro
      - ./servers/27/logs:/data/logs
      - ./servers/27/demos:/data/demos
    stop_grace_period: 30s
    stdin_open: true
    tty: true
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    profiles:
      - server27

  tf2classified-28:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        PUID: ${PUID:-1000}
        PGID: ${PGID:-1000}
    container_name: tf2classified-28
    restart: unless-stopped
    network_mode: host
    env_file:
      - .env.server28
    volumes:
      - tf2-data:/data/tf
      - classified-data:/data/classified
      - ./servers/28/cfg:/data/cfg:ro
      - ./servers/28/addons:/data/addons:ro
      - ./servers/28/maps:/data/maps:ro
      - ./servers/28/logs:/data/logs
      - ./servers/28/demos:/data/demos
    stop_grace_period: 30s
    stdin_open: true
    tty: true
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    profiles:
      - server28

  tf2classified-29:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        PUID: ${PUID:-1000}
        PGID: ${PGID:-1000}
    container_name: tf2classified-29
    restart: unless-stopped
    network_mode: host
    env_file:
      - .env.server29
    volumes:
      - tf2-data:/data/tf
      - classified-data:/data/classified
      - ./servers/29/cfg:/data/cfg:ro
      - ./servers/29/addons:/data/addons:ro
      - ./servers/29/maps:/data/maps:ro
      - ./servers/29/logs:/data/logs
      - ./servers/29/demos:/data/demos
    stop_grace_period: 30s
    stdin_open: true
    tty: true
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    profiles:
      - server29

  tf2classified-30:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        PUID: ${PUID:-1000}
        PGID: ${PGID:-1000}
    container_name: tf2classified-30
    restart: unless-stopped
    network_mode: host
    env_file:
      - .env.server30
    volumes:
      - tf2-data:/data/tf
      - classified-data:/data/classified
      - ./servers/30/cfg:/data/cfg:ro
      - ./servers/30/addons:/data/addons:ro
      - ./servers/30/maps:/data/maps:ro
      - ./servers/30/logs:/data/logs
      - ./servers/30/demos:/data/demos
    stop_grace_period: 30s
    stdin_open: true
    tty: true
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    profiles:
      - server30

volumes:
  tf2-data:
  classified-data:
